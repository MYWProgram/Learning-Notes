# 关于移动端穿透问题的解决方案

## 问题描述

在移动端当有 fixed 遮罩背景和弹出层时，滑动屏幕会带动背景下面的内容。

## 不成熟的解决方案

### overflow: hidden

```css
.modal-open {
  &, body {
    overflow: hidden;
    height: 100%;
  }
}
```

在页面弹出层上将 `.modal-open` 添加到 Html 上，禁用 Html 和 body 的滚动条；但是只在 CSS 上添加有两个缺点：

- 由于 Html 和 body 的滚动条都被禁用，弹出层后页面的滚动位置会丢失，需要用 JS 来还原。
- 页面的背景还是会有一些滚动效果。

### touchmove + preventDefault

```js
// 这里使用 touchmove 事件优于 touchstart，因为后者连点击事件都会阻止。
modal.addEventListener('touchmove', function(e) {
  e.preventDefault();
}, false);
```

使用 JS 阻止滚动效果之后还是会有缺点：

- 弹出层不能有其他的需要滚动的内容（例如大段文字需要固定高度，显示滚动条也会被阻止）。
- 这个方法只适用于弹出层内容小于屏幕高度，也就是不可滚动的时候。

## 成熟的解决方案

```css
body .modal-open {
  position: fixed;
  width: 100%;
}
```

如果只是对 CSS 进行上面的修改，滚动的位置同样会丢失；所以需要下面的 JS 代码加持。

```js
var touchMoveFixed = (function(bodyClass) {
  var scrollTop;
  return {
    afterOpen: function() {
      scrollTop = document.scrollingElement.scrollTop || document.documentElement.scrollTop || document.body.scrollTop;
      document.body.classList.add(bodyClass);
      document.body.style.top = -scrollTop + 'px';
    },
    beforeClose: function() {
      document.body.classList.remove(bodyClass);
      document.scrollingElement.scrollTop = document.documentElement.scrollTop = document.body.scrollTop = scrollTop;
    }
  }
})('modal-open');
```

`document.scrollingElement` 返回滚动文档的 Element 对象的引用：

- 标准模式下，这是文档的根元素，`document.documentElement`。
- 怪异模式下，scrollElement 属性返回 Html body 元素（不存在返回 null）。
